"use strict";angular.module("stack").controller("answerCtrl",["$scope","question","userService","questionsService","answersService",function(a,b,c,d,e){var f=this;c.isLogged()&&d.updateViews(b),c.getUserModel().then(function(a){f.user=a}),f.question=b,f.question.set("showCommentArea",!1),f.qTotalVote=b.instance.actions.votes.users_upvote.length-b.instance.actions.votes.users_downvote.length;for(var g=0,h=f.question.get("answers").length;h>g;g++)f.question.get("answers")[g].set("showCommentArea",!1);f.toLogin=function(){document.location.href="/auth/v0/github/connect"},f.checkVoteDown=function(a){var b=[];return f.user?(a.length&&(b=a.filter(function(a){return a===f.user.get("_id")})),b.length>0):!1},f.canCheckAnswer=function(){if(!f.user)return!1;var a=!0;if(b.get("author").get("id")===f.user.get("id"))for(var c=0,d=b.get("answers").length;d>c&&a;c++){var e=b.get("answers")[c];e.get("checked")&&(a=!1)}else a=!1;return a},f.toggleCommentArea=function(a,b){if(c.isLogged())if("answer"===a.get("cobjectId")){var d=f.question.get("answers")[b].get("showCommentArea")||!1;f.question.get("answers")[b].set("showCommentArea",!d);for(var e=0,g=f.question.get("answers").length;g>e;e++)e!==b&&f.question.get("answers")[e].set("showCommentArea",!1)}else f.question.set("showCommentArea",!f.question.get("showCommentArea"))},f.setChecked=function(a,b){b.set("checked",!0),a.set("checked",!0),e.updateModel(b,["checked"]).then(function(){return d.updateModel(a,["checked"])})["catch"](function(){console.error("Error during check answer"),b.set("checked",!1),a.set("checked",!1)})},f.commentQuestion=function(a,b){c.isLogged()&&d.commentQuestion(a,b).then(function(){f.questionCommentText=""})["catch"](function(a){console.log("Not authorized"),console.log(a)})},f.commentAnswer=function(a,b){e.comment(a,b).then(function(){f.commentAnswerText=""})["catch"](function(a){console.log("Not authorized"),console.log(a)})},f.voteUp=function(a,b){c.isLogged()&&(b?e.voteUp(b).then(function(a){b.totalVote=a})["catch"](function(){console.log("Not authorized")}):d.voteUp(a).then(function(a){f.qTotalVote=a||0})["catch"](function(){console.log("Not authorized")}))},f.voteDown=function(a,b){c.isLogged()&&(b?e.voteDown(b).then(function(a){b.totalVote=a})["catch"](function(){console.log("Not authorized")}):d.voteDown(a).then(function(a){f.qTotalVote=a||0})["catch"](function(){console.log("Not authorized")}))}}]),angular.module("stack").controller("answerEditCtrl",["$scope","userService","answersService","questionsService","$http",function(a,b,c,d,e){var f=this;b.isLogged()&&(f.newAnswer={checked:!1,text:""},b.getUserModel().then(function(a){f.user=a,f.newAnswer.author=a.get("id")})),f.successInCreation=!1,f.errorInCreation=!1,f.createAnswer=function(b){c.createAnswer(f.newAnswer).then(function(c){c.set("author",f.user),c.set("dt_create",moment(c.get("dt_create")).format("ll")),d.submitAnswer(b,c).then(function(){f.successInCreation=!0,a.$apply(function(){f.successInCreation=!1,f.newAnswer.text=""})})["catch"](function(a){f.errorInCreation=!0,setTimeout(function(){f.successInCreation=!1},2e3),alert("KO")})})["catch"](function(a){f.errorInCreation=!0,alert("KO")})}}]),angular.module("stack").controller("askCtrl",["$rootScope","$http","$location","userService","tagsService","questionsService",function(a,b,c,d,e,f){var g=this;g.cobj={},g.cobj.tags=[],g.cobj.answers=[],g.cobj.views=0,g.questionSubmitted=!1,d.getUserModel().then(function(a){g.cobj.author=a.get("_id")}),g.tags=[];var h={};g.getTags=function(a){var b='".*'+a+'.*"',c={where:'{"name": {"$regex" : '+b+"}}"};return e.searchTag(c).then(function(a){return a.forEach(function(a){var b=a.instance;h[b.name]=b.id;for(var c=!1,d=0,e=g.tags.length;e>d&&!c;d++){var f=g.tags[d];f.id===b.id&&(c=!0)}c||g.tags.push({name:b.name,id:b._id})}),g.tags})},g.onSelect=function(a,b,c){g.cobj.tags=a.id},g.createQuestion=function(){"string"==typeof g.cobj.tags&&(g.cobj.tags=[g.cobj.tags]),f.saveQuestion(g.cobj).then(function(){g.cobj={},g.cobj.tags=[],g.cobj.answers=[],g.cobj.views=0,g.cobj.author=a.user.id,g.cobj.owner=a.user.id,g.cobj.text="",g.current="",g.questionSubmitted=!0,c.url("/index")})["catch"](function(){alert("Error during question submit")})}}]),angular.module("stack").controller("homeCtrl",["questionsService",function(a){var b=this;b.questions=[],b.page=1,b.per_page=10,b.sort="-dt_create",b.loadQuestions=function(c){a.getQuestions(c).then(function(a){b.questions.add?a.forEach(function(a){b.questions.add(a)}):(b.questions=a,b.totalLength=b.questions.totalElement),b.page++,b.busy=!1})},b.loadNext=function(a){if(b.questions.length!==b.totalLength){b.busy=!0;var c={sort:b.sort,page:a,per_page:b.per_page,populate_owner:!0,populate:!0};b.loadQuestions(c)}},b.sortQuestion=function(a){switch(b.page=1,b.totalLength=0,b.questions=[],a){case"newest":b.sort="-dt_create";break;case"votes":b.sort="-actions.votes.total";break;case"active":b.sort="-dt_update";break;default:b.sort="-dt_create"}b.loadQuestions({sort:b.sort,page:b.page,per_page:b.per_page,populate_owner:!0,populate:!0})}}]),angular.module("stack").controller("menuCtrl",["$rootScope","$scope","$http","$location",function(a,b,c,d){b.$on("$routeChangeSuccess",function(){b.url=d.url()}),b.user=a.user,a.$watch("user",function(a,c){b.user=a},!0)}]),angular.module("stack").controller("tagsCtrl",["tagsService","$filter",function(a,b){var c=this;b("orderBy");c.orderTags=function(a){switch(a){case"name":c.tags.instance.sort(function(a,b){var c=a.get("name").toLowerCase(),d=b.get("name").toLowerCase();return d>c?-1:c>d?1:0}),c.order="name";break;case"-count":c.tags.instance.sort(function(a,b){var c=parseInt(a.get("count")),d=parseInt(b.get("count"));return d-c}),c.order="-count";break;case"-dt_create":c.tags.instance.sort(function(a,b){var c=a.get("dt_create"),d=b.get("dt_create");return new Date(d)-new Date(c)}),c.order="-dt_create"}},c.sort={popular:!0,name:!1,"-dt_create":!1},c.order="-count",c.searchTag="",a.getTags({sort:"-count"}).then(function(a){c.tags=a,c.allTags=a}),c.search=function(){var b='".*'+c.searchTag+'.*"',d={where:'{"name": {"$regex" : '+b+"}}"};a.searchTag(d).then(function(a){c.tags=a})}}]),angular.module("stack").controller("usersCtrl",["users","usersService",function(a,b){var c=this;c.sortOnNewUsers=!0,c.searchUser="",c.userList=a,c.search=function(){var a='".*'+c.searchUser+'.*"',d={where:'{"displayName": {"$regex" : '+a+', "$options": "i"}}'};b.searchUser(d).then(function(a){c.userList=a})}}]);